Ответственный: Быков Дмитрий
ТД:https://wi.sbis.ru/doc/platform/developmentapl/mobile/ui-controls/crud/

### Виджет компонент списка

Модуль содержит реализацию компонента списка реализующего стандартизированное поведение.

#### Использование в приложениях

- ru.tensor.sbis.login.auth_devices.devices.presentation.DeviceListFragment
- ru.tensor.sbis.design.selection.ui.fragment.SelectorContentFragment
- ru.tensor.sbis.motivation.feature.month.view.MonthFragment
- [Курьер](https://git.sbis.ru/mobileworkspace/apps/droid/courier)

#### Внешний вид

http://axure.tensor.ru/MobileStandart8/#p=%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%87%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5__%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F_02_&g=1

#### Концептуальное описание решения

- Класс ru.tensor.sbis.list.view.SbisList содержит реализацию RecyclerView, в которую добавлены
  методы и механизмы для реализации стандартизированного поведения.
- При работе с компонентом не предполагается использовать какую либо реализацию Adapter или
  LayoutManager, нужные реализации будут созданы внутри самого компонента, достаточно выставить
  нужные опции у компонента и предоставить список элементов, реализующих специальный интерфейс, для
  которых, так же, доступны опции.
- Элементы списка должны содержать логику работы с ViewHolder - создавать и привязывать данные к
  ранее уже созданному.

#### Поддержаны следующие требования стандарта:

1.Строки(Ячейки):

- Фон ячейки и эффект нажатия. Отключается через
  ru.tensor.sbis.list.view.item.ItemOptions.customBackground.
- Для отображения строк необходимо передать в метод SbisList::setListData класс
  ru.tensor.sbis.list.view.utils.Plain. Каждый элемент в списке будет иметь разделитель и отступ по
  бокам.
- Чтобы элемент был кликабельным и имел анимацию тапа, необходимо присвоить значение опции ячейки
  ru.tensor.sbis.list.view.item.ItemOptions.clickAction
- Чтобы элемент имел отступ слева(например, для отображения дерева), необходимо выставить значение
  уровня для ячейки в опцию ячейки ItemOptions.level.
- Чтобы элемент "прилипал"(sticky) в верхней границе экрана, необходимо выставить флаг в опцию
  ячейки ItemOptions.level.isSticky.
- Чтобы элемент можно было перемещать, необходимо выставить флаг в опцию ячейки
  ItemOptions.level.isMovable.
- Чтобы ячейку можно было перетаскивать, необходимо выставить флаг в опцию ячейки
  ItemOptions.level.isMovable. При окончании перетаскивания, сработает колбек, установленный методом
  SbisList::itemMoveCallback.
- Чтобы задать нестандартный отступ по бокам ячейки, необходимо выставить флаг в опцию ячейки
  ItemOptions.level.customSidePadding и установить требуемый отступ в самой View ячейки.
- Добавление и удаление отдельных элементов списко выполняется с анимацией, при этом:
- При добавлении ячейки, если на экране показано начало реестра, то все строки плавно сдвигаются
  вниз, а затем появляются новые (с анимацией - fade)
- При добавлении ячейки, если реестр прокручен вниз (мы не видим начало реестра), строки добавляются
  вверх таблицы без анимации и без сдвига. Новые строки мы увидим, когда прокрутим реестр вверх.
  Удаление строк.
- Если удаляемые строки находятся в видимой части на экране, то при удадении они исчезают (с
  анимацией - fade), на их месте показывается пустое пространство. Затем, после небольшой задержки,
  пространство плавно схлапывается (строки подтягиваются вверх)
- Если в видимой на экране части реестра не видно удаляемых строк, то они удаляются без анимации и
  сдвига.

2.Блоки

- Для отображения блоков необходимо передать в метод SbisList::setListData класс
  ru.tensor.sbis.list.view.utils.Sections. Каждый элемент переданного списка будет отделен отступом.
- В качестве цвета фона будет установлен цвет согласно стандарту - серый, но если блок один, то
  белый. Доступно выставление серого цвета фона в не зависимости от количества блоков - метод
  SbisList::setForcedDarkBackground(true)
- Цветовой индикатор внутри блока можно задать через опции блока
  ru.tensor.sbis.list.view.section.SectionOptions.indicatorColor.
- Наличие или отсутствие разделителей между элементами внутри блока можно задать через опции блока
  ru.tensor.sbis.list.view.section.SectionOptions.hasDividers.

3.Бесконечный список Компонент списка позволяет использовать колбек для оповещения необходимости
подгрузки дополнительных данных при достижении конца или начала списка, для этого необходимо
использовать метод SbisList::setLoadMoreCallback. Управление отображением самого индикатора
подгрузки выполняется методом SbisList::loadProgressIsVisible.

4.Плавающая кнопка Компонент списка позволяет добавлять пространство в конец списка, чтобы FAB не
загораживала последнюю ячейку. Для этого нужно использовать метод SbisList::fabPadding(true).

5.Темизация По умолчанию используется тема Коммуникатор. Для задачи своей темы необходимо добавить в
тему приложения атрибут `list_theme` со ссылкой на перегруженную тему `List` из модуля. Доступные
атрибуты:
`list_content_background` - основной цвет фона списка, для светлой темы соответствует цвету строки.
`list_content_dark_background` - цвет фона списка для выделения групп, а так же цвет разделителей.
`list_item_background_color_states` - ресурс фона элемента списка, должен поддерживать эффект нажатия, будет
добавляться для каждого элемента, для которого в опциях не выставлен флаг customBackground.

6.FAQ В: При обновлении списка, элементы, которые уже были в таблице, моргают. А: При создании
элемента(как правило - BindingItem) нужно передать реализацию ComparableItem(как правило, вью модель
ячейки) методы которой будут использоваться DiffUtil для предотвращения пересоздания элементов.

В: Нужны кастомные отступы и фон ячеек, а список их выставляет сам. А: Своя реализация
ru.tensor.sbis.list.view.item.ItemOptions и ru.tensor.sbis.list.view.section.SectionOptions позволит
изменить много стандартных значений свойств.

В: В компоненте списка мне не хватает, чтобы он делал [ваша фича], я хочу сделать это сам. А:
Необходимо обратиться к руководителю команды платформы с запросом на фичу, самостоятельня доработка
не приветствуется. Причин несколько:

- ревью кода и анализ решения займет времени столько же сколько сама доработка.
- Если в компоненте не поддержано какое-нибудь поведение, то, скорее всего, оно не входит в стандарт
  и это нужно согласовать с проектированием.

В: Есть небходимость обновлять поля вью моделей ячеек без повторного их полного биндинга к вью. А:
При создании элементов необходимо передавать реализации
ru.tensor.sbis.list.view.item.merge.MergeableItem и
ru.tensor.sbis.list.view.item.comparator.ComparableItem

### Fragment для отображения компоновки Master-Detail.

Модуль содержит реализацию компонента компоновки Master-Detail для фрагментов.

#### Использование в приложениях

Еще не используется.

#### Внешний вид

http://axure.tensor.ru/MobileStandart8/#p=%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%BE%D0%B4_%D0%BF%D0%BB%D0%B0%D0%BD%D1%88%D0%B5%D1%82&g=1

#### Концептуальное описание решения

- Фрагмент ru.tensor.sbis.master_detail.MasterDetailFragment инкапсулирует логику работы по
  отображению Master и Detail фрагментов в сответствии с конфигурцией экрана.
- Пользователю необходимо лишь реализовать методы базового фрагмента для создания Master и Detail
  фрагментов.
- Если в Master фрагменте используется SbisList, то он настраивается автоматически на нужный режим
  отображения(на планшете нажатая строка остается выделенной после нажатия и пр.)

#### Поддержаны следующие требования стандарта:

- Ширина Master фрагмента.
- Подсветка выделенных строк(для SbisList)
- Отображение заглушки в зоне Detail фрагмента.

#### Интеграция

- Активити должна реализовывать интерфейс
  ru.tensor.sbis.declaration.viewprovider.OverlayFragmentHolder.

##### Трудозатраты внедрения
1.1 ч/д